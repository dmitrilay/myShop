{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}Корзина{% endblock %}

{% block content %}
<p class="text-muted h3 font-weight-bold">Моя корзина</p>

<br>

<div class="col-md-7 mb-7 sm-7">
<table class="table table-sm">
    <thead>
    <tr>
        <th>Продукт</th>
        <th>Цена</th>
        <th></th>
    </tr>
    </thead>
    <tbody>
        {% for item in cart %}
            {% with product=item.product %}
                <tr>
                    <td>{{ product.name }}</td>
                    <td class="num">{{ item.total_price }}₽</td>
                    <td>
                        <button type="button" class="btn btn-success btn-sm" data-toggle="modal" data-target='#{{ product.name|cut:" " }}'>
                            Изменить
                        </button>
                        <!-- Modal -->
                        <div class="modal fade" id='{{ product.name|cut:" " }}' tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                          <div class="modal-dialog" role="document">
                            <div class="modal-content">
                              <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel">{{ product.name }}</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                  <span aria-hidden="true">&times;</span>
                                </button>
                              </div>
                              <div class="mod1al-body">
                                <div class="col-md-7 mb-7 sm-7">
                                   <div class="modal-body">
                                    <form action="{% url 'cart:cart_add' product.id %}" method="post">
                                        {% csrf_token %}
                                        {{ item.update_quantity_form.quantity|as_crispy_field }}
                                        {{ item.update_quantity_form.update|as_crispy_field }}
                                        <input class="btn btn-primary btn-block" type="submit" value="Обновить">
                                    </form>
                                   </div>

                                  <div class="modal-body">
                                      <a class="btn btn-danger btn-block" href="{% url 'cart:cart_remove' product.id%}">
                                          Удалить позицию
                                      </a>
                                  </div>
                              </div>
                              <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                              </div>
                            </div>
                          </div>
                        </div>
                    </td>
                </tr>
            {% endwith %}
        {% endfor %}
    </tbody>
</table>

    <div>
        <h5>В корзине: {{ cart.get_total_price }}₽</h5>
    </div>
</div>



<br><br><br>

<div class="form-group col-md-6 mb-0">
    <div><a href="{% url 'orders:order_create' %}" class="btn btn-outline-warning btn-lg btn-block">Продолжить</a></div>
    <br>
    <div><a href="{% url 'shop:product_list' %}" class="button light">Вернутся в каталог</a></div>
</div>
{% endblock %}